function lmInput(){return{scope:{bindModel:"=ngModel"},require:"ngModel",transclude:!0,templateUrl:"/app/control/input/input-control.html",link:function(t,e,n,o){"use strict"}}}!function(){"use strict";function t(t){t.activeTab="/",t.$on("$routeChangeStart",function(e,n){n.$$route&&(t.activeTab=n.$$route.originalPath)})}function e(t,e){t.otherwise({redirectTo:"/"}),e.html5Mode(!0)}function n(t,e,n){t.$on("$routeChangeSuccess",function(){n.ga&&n.ga("send","pageview",{page:e.path()})})}function o(t){function e(e){var n,o=$(".menu-indicator"),i=$("li.active-menu").index();n=t.tabs[e.index],i>e.index?(o.removeClass("right"),o.addClass("left"),o.css({left:n.left}),o.css({right:n.right})):(o.removeClass("left"),o.addClass("right"),o.css({right:n.right}),o.css({left:n.left}))}t.$on("$routeChangeStart",function(n,o){var i=$("menu ul").width();$("menu ul li").each(function(n,o){var r=$(o).outerWidth(),l=t.tabs[n];if(l.index=n,0===n)l.left=0,l.right=i-r;else{var u=t.tabs[n-1];l.left=i-u.right,l.right=u.right-r}t.activeTab.indexOf(l.id)>-1&&e(l)})}),t.tabs=[new i("/","Все"),new i("/film","Фильмы"),new i("/serial","Сериалы"),new i("/anime","Аниме"),new i("/other","Прочее"),new i("/upload","Загрузить фильм")],t.selectTab=e}function i(t,e,n){this.id=t,this.name=e,this.selected=n}angular.module("App",["ngRoute","ngAnimate","app.auth","ContentModule","ControlsModule","ContentCardModule","ItemModule","UploadModule","ProfileModule","RecentModule"]).config(e).run(t).run(n).controller("NavigationCtrl",o),t.$inject=["$rootScope"],e.$inject=["$routeProvider","$locationProvider"],n.$inject=["$rootScope","$location","$window"],o.$inject=["$scope"],i.prototype={id:"",name:"",selected:!1},angular.module("App").directive("background",function(){return function(t,e,n){var o=n.background;e.css({"background-image":"url("+o+")","background-size":"cover"})}})}(),function(){function t(t){"ngInject";t.when("/",{templateUrl:"/app/content/content.html",controller:"AllContentCtrl"}).when("/film",{templateUrl:"/app/content/content.html",controller:"FilmContentCtrl"}).when("/serial",{templateUrl:"/app/content/content.html",controller:"SerialContentCtrl"})}function e(t,e){t.content=e.findContent()}function n(t,e){t.content=e.findContent(null,"Film")}function o(t,e){t.content=e.findContent(null,"Serial")}t.$inject=["$routeProvider"],angular.module("ContentModule",["ContentServices"]).config(t).controller("AllContentCtrl",e).controller("SerialContentCtrl",o).controller("FilmContentCtrl",n),e.$inject=["$scope","ContentService"],n.$inject=["$scope","ContentService"],o.$inject=["$scope","ContentService"]}(),function(){"use strict";angular.module("app.auth",["ngRoute","ngResource","ngCookies","ControlsModule"])}(),angular.module("UploadModule",["ngResource"]),function(){"use strict";function t(t){return t("api/content/{id}")}angular.module("ContentModule").factory("ContentResource",t),t.$inject=["$resource"]}(),function(){"use strict";function t(t){function e(t,e){return i.query({name:t,type:e})}function n(t){var e=new i(t);return e.$save(),e}var o=this,i=t("/rest/content",{},{});return o.findContent=e,o.createContent=n,o}angular.module("ContentServices",["ngResource"]).factory("ContentService",t),t.$inject=["$resource"]}(),function(){function t(t){"ngInject";t.when("/film/:content_id",{templateUrl:"/app/content-card/content-card.html",controller:"FilmCardCtrl"}).when("/serial/:content_id",{templateUrl:"/app/content-card/content-card.html",controller:"SerialCardCtrl"})}function e(){"ngInject"}function n(){"ngInject"}t.$inject=["$routeProvider"],angular.module("ContentCardModule",[]),angular.module("ContentCardModule").config(t).controller("FilmCardCtrl",e).controller("SerialCardCtrl",n)}(),function(){"use strict";angular.module("ControlsModule",["control.input-control","control.parser","control.input-chunk"])}(),function(){function t(t){"ngInject";function e(e,n,o){n.on("click",function(n){t.path("/"+angular.lowercase(e.item.type)+"/"+e.item.id),e.$apply()})}return{link:e,restrict:"E",replace:!0,scope:{item:"="},templateUrl:"/app/item/item.html"}}angular.module("ItemModule",[]).directive("contentItem",t),t.$inject=["$location"]}(),function(){"use strict";function t(t,e,n){function o(e,n){t.login(e,n)}var i=this;i.auth=o,n.$on("oauth:login",function(n){console.log(t.isAuthenticated),t.isAuthenticated&&e.path("/")})}angular.module("app.auth").controller("LoginController",t),t.$inject=["AuthService","$location","$scope"]}(),function(){"use strict";function t(t){t.when("/login",{templateUrl:"/app/login/login.html"})}function e(t,e,n){t.$on("$routeChangeStart",function(t,o,i){console.log(n.isAuthenticated+" : "+o.$$route.originalPath),n.isAuthenticated||"/login"==o.$$route.originalPath||(t.preventDefault(),console.log("need auth"),e.path("/login"))})}angular.module("app.auth").run(e).config(t),t.$inject=["$routeProvider"],e.$inject=["$rootScope","$location","AuthService"]}(),function(){function t(t,e,n,o,i){function r(r,u){t.auth(n({scope:"ui",username:r,password:u,grant_type:"password"})).$promise.then(function(t){e.defaults.headers.common.Authorization="Bearer "+t.access_token,o.put("access_token",t.access_token),l.isAuthenticated=!0,i.$broadcast("oauth:login",t),console.log(t)},function(){l.isAuthenticated=!1,i.$emit("oauth:login")})}var l=this;return l.isAuthenticated=!1,l.login=r,l}function e(t){return t("/api/auth/:path/:token",{},{auth:{method:"POST",params:{path:"oauth",token:"token"},isArray:!1,headers:{Authorization:"Basic YnJvd3Nlcjo=","Content-type":"application/x-www-form-urlencoded; charset=utf-8"}}})}angular.module("app.auth").factory("AuthService",t).factory("AuthResource",e),t.$inject=["AuthResource","$http","$httpParamSerializer","$cookies","$rootScope"],e.$inject=["$resource"]}(),function(){"use strict";function t(t){"ngInject";t.when("/profile",{templateUrl:"/app/profile/profile.html",controller:"ProfileCtrl"})}function e(t){function e(t){return profile.perms.indexOf(t)>-1}t.profile={login:"Braidner",perms:["user:edit:profile"]},t.hasPermission=e}function n(){}t.$inject=["$routeProvider"],e.$inject=["$rootScope"],angular.module("ProfileModule",[]),angular.module("ProfileModule").config(t),angular.module("ProfileModule").run(e),angular.module("ProfileModule").controller("ProfileCtrl",n)}(),function(){"use strict";function t(t){t.content=[{name:"Zootopia",poster:"http://www.kinopoisk.ru/images/film_big/775276.jpg",id:0,type:"film"},{name:"Batman v Superman: Dawn of Justice",poster:"http://www.kinopoisk.ru/images/film_big/770631.jpg",id:0,type:"film"},{name:"The Justice League Part One",poster:"http://www.kinopoisk.ru/images/film_big/424994.jpg",id:0,type:"film"},{name:"The flash",poster:"http://www.kinopoisk.ru/images/film_big/817506.jpg",id:0,type:"film"},{name:"The Justice League Part One",poster:"http://www.kinopoisk.ru/images/film_big/424994.jpg",id:0,type:"film"},{name:"Frozen",poster:"http://www.kinopoisk.ru/images/film_big/493208.jpg",id:0,type:"film"},{name:"Batman v Superman: Dawn of Justice",poster:"http://www.kinopoisk.ru/images/film_big/770631.jpg",id:0,type:"film"},{name:"Untitled Spider-Man Reboot",poster:"http://www.kinopoisk.ru/images/film_big/690593.jpg",id:0,type:"film"}]}angular.module("RecentModule",[]).controller("RecentCtrl",t),t.$inject=["$scope"],angular.module("RecentModule").directive("owlCarousel",function(){var t=function(t,e,n){var o=function(){e.owlCarousel({loop:!1,nav:!1,responsive:{1200:{items:6},992:{items:4},768:{items:3},479:{items:2}}})};t.$watchCollection(n.owlCarousel,function(){o()})};return{restrict:"A",link:t}})}(),function(){"use strict";function t(t,e){var n=this,o=t.get();t.set(null),o&&(n.content=o),n.createContent=e.createContent}angular.module("UploadModule").controller("UploadCtrl",t),t.$inject=["UploadData","UploadService"]}(),function(){"use strict";function t(){function t(t){n=t}function e(){return n}var n={};return{set:t,get:e}}angular.module("UploadModule").factory("UploadData",t)}(),function(){"use strict";function t(t){t.when("/upload",{templateUrl:"/app/upload/upload.html"})}angular.module("UploadModule").config(t),t.$inject=["$routeProvider"]}(),function(){"use strict";function t(t,e){function n(){var n=t.get(),o=new e(n);return o.id}var o=this;return o.createContent=n,o}angular.module("UploadModule").service("UploadService",t),t.$inject=["UploadData","ContentResource"]}(),function(){function t(){return{scope:{bindModel:"=ngModel"},require:"ngModel",transclude:!0,templateUrl:"/app/control/input-chunk/input-chunk.html",link:function(t,e,n,o){"use strict"}}}angular.module("control.input-chunk",[]),angular.module("control.input-chunk").directive("lmInputChunk",t)}(),angular.module("control.input-control",[]).directive("lmInput",lmInput),function(){function t(t,e,n){return{scope:{bindModel:"=ngModel"},require:"ngModel",transclude:!0,templateUrl:"/app/control/url-parser-control/url-parser-control.html",link:function(o,i,r,l){"use strict";i.find(".button").on("click",function(){e.get("/rest/kinopoisk",{params:{url:o.bindModel}}).then(function(e){e.data.url=o.bindModel,n.set(e.data),t.path("/upload")})})}}}angular.module("control.parser",[]),angular.module("ControlsModule").directive("lmUrlParser",t),t.$inject=["$location","$http","UploadData"]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnRyb2wvaW5wdXQvSW5wdXRDb250cm9sLmpzIiwiYXBwLm1vZHVsZS5qcyIsImNvbnRlbnQvY29udGVudC5tb2R1bGUuanMiLCJhbGwubWluLmpzIiwibG9naW4vYXV0aC5tb2R1bGUuanMiLCJ1cGxvYWQvdXBsb2FkLm1vZHVsZS5qcyIsImNvbnRlbnQvY29udGVudC5yZXNvdXJjZS5qcyIsImNvbnRlbnQvY29udGVudC5zZXJ2aWNlLmpzIiwiY29udGVudC1jYXJkL0NvbnRlbnRDYXJkTW9kdWxlLmpzIiwiY29udHJvbC9Db250cm9sc01vZHVsZS5qcyIsIml0ZW0vSXRlbU1vZHVsZS5qcyIsImxvZ2luL2F1dGguY29udHJvbGxlci5qcyIsImxvZ2luL2F1dGgucm91dGUuanMiLCJsb2dpbi9hdXRoLnNlcnZpY2UuanMiLCJwcm9maWxlL1Byb2ZpbGVNb2R1bGUuanMiLCJyZWNlbnQvUmVjZW50TW9kdWxlLmpzIiwidXBsb2FkL3VwbG9hZC5jb250cm9sbGVyLmpzIiwidXBsb2FkL3VwbG9hZC5yZXNvdXJjZS5qcyIsInVwbG9hZC91cGxvYWQucm91dGUuanMiLCJ1cGxvYWQvdXBsb2FkLnNlcnZpY2UuanMiLCJjb250cm9sL2lucHV0LWNodW5rL2lucHV0Q2h1bmsuanMiLCJjb250cm9sL3VybC1wYXJzZXItY29udHJvbC91cmxQYXJzZXJDb250cm9sLmpzIl0sIm5hbWVzIjpbImxtSW5wdXQiLCJzY29wZSIsImJpbmRNb2RlbCIsInJlcXVpcmUiLCJ0cmFuc2NsdWRlIiwidGVtcGxhdGVVcmwiLCJsaW5rIiwiZWxlbSIsImF0dHIiLCJuZ01vZGVsIiwiTW9uaXRvckNvbmZpZyIsIiRyb290U2NvcGUiLCJhY3RpdmVUYWIiLCIkb24iLCJldmVudCIsIm5leHQiLCIkJHJvdXRlIiwib3JpZ2luYWxQYXRoIiwiUm91dGVDb25maWciLCIkcm91dGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwib3RoZXJ3aXNlIiwicmVkaXJlY3RUbyIsImh0bWw1TW9kZSIsIkFuYWx5dGljc0NvbmZpZyIsIiRsb2NhdGlvbiIsIiR3aW5kb3ciLCJnYSIsInBhZ2UiLCJwYXRoIiwiTmF2aWdhdGlvbkN0cmwiLCIkc2NvcGUiLCJzZWxlY3RUYWIiLCJ0YWIiLCJzZWxlY3RlZFRhYiIsImluZGljYXRvciIsIiQiLCJpbmRleCIsInRhYnMiLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIiwiY3NzIiwibGVmdCIsInJpZ2h0IiwiY3VycmVudCIsInRvdGFsV2lkdGgiLCJ3aWR0aCIsImVhY2giLCJlbCIsIm91dGVyV2lkdGgiLCJsYXN0VGFiIiwiaW5kZXhPZiIsImlkIiwiVGFiIiwibmFtZSIsInNlbGVjdGVkIiwidGhpcyIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCJydW4iLCJjb250cm9sbGVyIiwiJGluamVjdCIsInByb3RvdHlwZSIsImRpcmVjdGl2ZSIsImVsZW1lbnQiLCJhdHRycyIsInVybCIsImJhY2tncm91bmQiLCJiYWNrZ3JvdW5kLWltYWdlIiwiYmFja2dyb3VuZC1zaXplIiwid2hlbiIsIkFsbENvbnRlbnRDdHJsIiwiQ29udGVudFNlcnZpY2UiLCJjb250ZW50IiwiZmluZENvbnRlbnQiLCJGaWxtQ29udGVudEN0cmwiLCJTZXJpYWxDb250ZW50Q3RybCIsIkNvbnRlbnRSZXNvdXJjZSIsIiRyZXNvdXJjZSIsImZhY3RvcnkiLCJ0eXBlIiwiQ29udGVudCIsInF1ZXJ5IiwiY3JlYXRlQ29udGVudCIsImNvbnRlbnREYXRhIiwiJHNhdmUiLCJzZWxmIiwiRmlsbUNhcmRDdHJsIiwiU2VyaWFsQ2FyZEN0cmwiLCJjb250ZW50SXRlbSIsImxpbmtlciIsIm9uIiwibG93ZXJjYXNlIiwiaXRlbSIsIiRhcHBseSIsInJlc3RyaWN0IiwicmVwbGFjZSIsIkxvZ2luQ29udHJvbGxlciIsIkF1dGhTZXJ2aWNlIiwiYXV0aCIsImxvZ2luIiwicGFzc3dvcmQiLCJ0b2tlbiIsImNvbnNvbGUiLCJsb2ciLCJpc0F1dGhlbnRpY2F0ZWQiLCJSb3V0ZUludGVyY2VwdG9yIiwicHJldmVudERlZmF1bHQiLCJBdXRoUmVzb3VyY2UiLCIkaHR0cCIsIiRodHRwUGFyYW1TZXJpYWxpemVyIiwiJGNvb2tpZXMiLCJlbWFpbCIsInVzZXJuYW1lIiwiZ3JhbnRfdHlwZSIsIiRwcm9taXNlIiwidGhlbiIsImRhdGEiLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iLCJBdXRob3JpemF0aW9uIiwiYWNjZXNzX3Rva2VuIiwicHV0IiwiJGJyb2FkY2FzdCIsIiRlbWl0IiwibWV0aG9kIiwicGFyYW1zIiwiaXNBcnJheSIsIkNvbnRlbnQtdHlwZSIsIlByb2ZpbGVDb25maWciLCJoYXNQZXJtaXNzaW9uIiwicGVybSIsInByb2ZpbGUiLCJwZXJtcyIsIlByb2ZpbGVDdHJsIiwiUmVjZW50Q3RybCIsInBvc3RlciIsImxvYWRDYXJvdXNlbCIsIm93bENhcm91c2VsIiwibG9vcCIsIm5hdiIsInJlc3BvbnNpdmUiLCIxMjAwIiwiaXRlbXMiLCI5OTIiLCI3NjgiLCI0NzkiLCIkd2F0Y2hDb2xsZWN0aW9uIiwiVXBsb2FkQ3RybCIsIlVwbG9hZERhdGEiLCJVcGxvYWRTZXJ2aWNlIiwiZ2V0Iiwic2V0IiwidXBsb2FkRGF0YSIsImNyZWF0ZWRDb250ZW50Iiwic2VydmljZSIsImlucHV0Q2h1bmsiLCJsbVVybFBhcnNlciIsImZpbmQiLCJyZXNwb25jZSJdLCJtYXBwaW5ncyI6IkFBUUEsUUFBQUEsV0FDQSxPQUNBQyxPQUNBQyxVQUFBLFlBRUFDLFFBQUEsVUFDQUMsWUFBQSxFQUNBQyxZQUFBLHdDQUNBQyxLQUFBLFNBQUFMLEVBQUFNLEVBQUFDLEVBQUFDLEdBQ0EsZ0JDZEEsV0FDQSxZQXNCQSxTQUFBQyxHQUFBQyxHQUNBQSxFQUFBQyxVQUFBLElBQ0FELEVBQUFFLElBQUEsb0JBQUEsU0FBQUMsRUFBQUMsR0FFQUEsRUFBQUMsVUFDQUwsRUFBQUMsVUFBQUcsRUFBQUMsUUFBQUMsZ0JBTUEsUUFBQUMsR0FBQUMsRUFBQUMsR0FDQUQsRUFBQUUsV0FDQUMsV0FB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QSw0Q0FDQUMsS0FBQSxTQUFBTCxFQUFBTSxFQUFBQyxFQUFBQyxHQUNBLGVBZkFnRCxRQUFBQyxPQUFBLDBCQUNBRCxRQUFBQyxPQUFBLHVCQUNBTSxVQUFBLGVBQUE4RixNcEJFQXJHLFFBQUFDLE9BQUEsNEJBQ0FNLFVBQUEsVUFBQWhFLFNxQkhBLFdBTUEsUUFBQStKLEdBQUF0SSxFQUFBcUYsRUFBQXlDLEdBQ0EsT0FDQXRKLE9BQ0FDLFVBQUEsWUFFQUMsUUFBQSxVQUVBQyxZQUFBLEVBQ0FDLFlBQUEsMERBQ0FDLEtBQUEsU0FBQUwsRUFBQU0sRUFBQUMsRUFBQUMsR0FDQSxZQUNBRixHQUFBeUosS0FBQSxXQUFBcEUsR0FBQSxRQUFBLFdBQ0FrQixFQUFBMkMsSUFBQSxtQkFBQXpCLFFBQUE3RCxJQUFBbEUsRUFBQUMsYUFBQW1ILEtBQUEsU0FBQTRDLEdBQ0FBLEVBQUEzQyxLQUFBbkQsSUFBQWxFLEVBQUFDLFVBQ0FxSixFQUFBRyxJQUFBTyxFQUFBM0MsTUFDQTdGLEVBQUFJLEtBQUEsaUJBcEJBNEIsUUFBQUMsT0FBQSxxQkFFQUQsUUFBQUMsT0FBQSxrQkFBQU0sVUFBQSxjQUFBK0YsR0FFQUEsRUFBQWpHLFNBQUEsWUFBQSxRQUFBIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBnb29kbCBvbiA0LzIvMjAxNi5cclxuICovXHJcblxyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2NvbnRyb2wuaW5wdXQtY29udHJvbCcsIFtdKVxyXG4gICAgLmRpcmVjdGl2ZSgnbG1JbnB1dCcsIGxtSW5wdXQpO1xyXG5cclxuZnVuY3Rpb24gbG1JbnB1dCgpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgYmluZE1vZGVsOic9bmdNb2RlbCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICd0ZW1wbGF0ZVVybCc6ICcvYXBwL2NvbnRyb2wvaW5wdXQvaW5wdXQtY29udHJvbC5odG1sJyxcclxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW0sIGF0dHIsIG5nTW9kZWwpIHtcclxuICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICAgICAgICAgIC8vIGVsZW0ub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyAgICAgZWxlbS5hZGRDbGFzcygnbG0taW5wdXQtZm9jdXNlZCcpO1xyXG4gICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IEJyYWlkbmVyIG9uIDMwLzAxLzIwMTYuXG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ0FwcCcsIFtcbiAgICAgICAgJ25nUm91dGUnLFxuICAgICAgICAnbmdBbmltYXRlJyxcblxuICAgICAgICAvL01vZHVsZXNcbiAgICAgICAgJ2FwcC5hdXRoJyxcbiAgICAgICAgJ0NvbnRlbnRNb2R1bGUnLFxuICAgICAgICAnQ29udHJvbHNNb2R1bGUnLFxuICAgICAgICAnQ29udGVudENhcmRNb2R1bGUnLFxuICAgICAgICAnSXRlbU1vZHVsZScsXG4gICAgICAgICdVcGxvYWRNb2R1bGUnLFxuICAgICAgICAnUHJvZmlsZU1vZHVsZScsXG4gICAgICAgICdSZWNlbnRNb2R1bGUnXG4gICAgXSlcbiAgICAgICAgLmNvbmZpZyhSb3V0ZUNvbmZpZylcbiAgICAgICAgLnJ1bihNb25pdG9yQ29uZmlnKVxuICAgICAgICAucnVuKEFuYWx5dGljc0NvbmZpZylcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJOYXZpZ2F0aW9uQ3RybFwiLCBOYXZpZ2F0aW9uQ3RybCk7XG5cbiAgICBNb25pdG9yQ29uZmlnLiRpbmplY3QgPSBbJyRyb290U2NvcGUnXTtcbiAgICBmdW5jdGlvbiBNb25pdG9yQ29uZmlnKCRyb290U2NvcGUpIHtcbiAgICAgICAgJHJvb3RTY29wZS5hY3RpdmVUYWIgPSBcIi9cIjtcbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50LCBuZXh0KSB7XG4gICAgICAgICAgICAvL1RPRE8gYWRkIG1vbml0b3JpbmdcbiAgICAgICAgICAgIGlmIChuZXh0LiQkcm91dGUpIHtcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmFjdGl2ZVRhYiA9IG5leHQuJCRyb3V0ZS5vcmlnaW5hbFBhdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIFJvdXRlQ29uZmlnLiRpbmplY3QgPSBbJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJ107XG4gICAgZnVuY3Rpb24gUm91dGVDb25maWcoJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLm90aGVyd2lzZSh7XG4gICAgICAgICAgICByZWRpcmVjdFRvOiAnLydcbiAgICAgICAgfSk7XG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcbiAgICB9XG5cbiAgICBBbmFseXRpY3NDb25maWcuJGluamVjdCA9IFsnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJHdpbmRvdyddO1xuICAgIGZ1bmN0aW9uIEFuYWx5dGljc0NvbmZpZygkcm9vdFNjb3BlLCAkbG9jYXRpb24sICR3aW5kb3cpIHtcbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZVN1Y2Nlc3MnLFxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICghJHdpbmRvdy5nYSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICR3aW5kb3cuZ2EoJ3NlbmQnLCAncGFnZXZpZXcnLCB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2U6ICRsb2NhdGlvbi5wYXRoKClcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBOYXZpZ2F0aW9uQ3RybC4kaW5qZWN0ID0gWyckc2NvcGUnXTtcbiAgICBmdW5jdGlvbiBOYXZpZ2F0aW9uQ3RybCAoJHNjb3BlKSB7XG4gICAgICAgICRzY29wZS4kb24oJyRyb3V0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50LCBjdXJyZW50KSB7XG4gICAgICAgICAgICB2YXIgdG90YWxXaWR0aCA9ICQoJ21lbnUgdWwnKS53aWR0aCgpO1xuICAgICAgICAgICAgJChcIm1lbnUgdWwgbGlcIikuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gJChlbCkub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICAgICAgIHZhciB0YWIgPSAkc2NvcGUudGFic1tpbmRleF07XG4gICAgICAgICAgICAgICAgdGFiLmluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYi5sZWZ0ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGFiLnJpZ2h0ID0gdG90YWxXaWR0aCAtIHdpZHRoO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXN0VGFiID0gJHNjb3BlLnRhYnNbaW5kZXggLSAxXTtcbiAgICAgICAgICAgICAgICAgICAgdGFiLmxlZnQgPSB0b3RhbFdpZHRoIC0gbGFzdFRhYi5yaWdodDtcbiAgICAgICAgICAgICAgICAgICAgdGFiLnJpZ2h0ID0gbGFzdFRhYi5yaWdodCAtIHdpZHRoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmFjdGl2ZVRhYi5pbmRleE9mKHRhYi5pZCkgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RUYWIodGFiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLnRhYnMgPSBbXG4gICAgICAgICAgICBuZXcgVGFiKFwiL1wiLCBcItCS0YHQtVwiKSxcbiAgICAgICAgICAgIG5ldyBUYWIoXCIvZmlsbVwiLCBcItCk0LjQu9GM0LzRi1wiKSxcbiAgICAgICAgICAgIG5ldyBUYWIoXCIvc2VyaWFsXCIsIFwi0KHQtdGA0LjQsNC70YtcIiksXG4gICAgICAgICAgICBuZXcgVGFiKFwiL2FuaW1lXCIsIFwi0JDQvdC40LzQtVwiKSxcbiAgICAgICAgICAgIG5ldyBUYWIoXCIvb3RoZXJcIiwgXCLQn9GA0L7Rh9C10LVcIiksXG4gICAgICAgICAgICBuZXcgVGFiKFwiL3VwbG9hZFwiLCBcItCX0LDQs9GA0YPQt9C40YLRjCDRhNC40LvRjNC8XCIpXG4gICAgICAgIF07XG4gICAgICAgIFxuICAgICAgICAkc2NvcGUuc2VsZWN0VGFiID0gc2VsZWN0VGFiO1xuXG4gICAgICAgIGZ1bmN0aW9uIHNlbGVjdFRhYih0YWIpIHtcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZFRhYjtcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3IgPSAkKCcubWVudS1pbmRpY2F0b3InKTtcbiAgICAgICAgICAgIHZhciBpbmRleCA9ICQoJ2xpLmFjdGl2ZS1tZW51JykuaW5kZXgoKTtcblxuICAgICAgICAgICAgc2VsZWN0ZWRUYWIgPSAkc2NvcGUudGFic1t0YWIuaW5kZXhdO1xuICAgICAgICAgICAgaWYgKGluZGV4ID4gdGFiLmluZGV4KSB7XG4gICAgICAgICAgICAgICAgaW5kaWNhdG9yLnJlbW92ZUNsYXNzKFwicmlnaHRcIik7XG4gICAgICAgICAgICAgICAgaW5kaWNhdG9yLmFkZENsYXNzKFwibGVmdFwiKTtcbiAgICAgICAgICAgICAgICBpbmRpY2F0b3IuY3NzKHtsZWZ0OiBzZWxlY3RlZFRhYi5sZWZ0fSk7XG4gICAgICAgICAgICAgICAgaW5kaWNhdG9yLmNzcyh7cmlnaHQ6IHNlbGVjdGVkVGFiLnJpZ2h0fSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGluZGljYXRvci5yZW1vdmVDbGFzcyhcImxlZnRcIik7XG4gICAgICAgICAgICAgICAgaW5kaWNhdG9yLmFkZENsYXNzKFwicmlnaHRcIik7XG4gICAgICAgICAgICAgICAgaW5kaWNhdG9yLmNzcyh7cmlnaHQ6IHNlbGVjdGVkVGFiLnJpZ2h0fSk7XG4gICAgICAgICAgICAgICAgaW5kaWNhdG9yLmNzcyh7bGVmdDogc2VsZWN0ZWRUYWIubGVmdH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gVGFiKGlkLCBuYW1lLCBzZWxlY3RlZCkge1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBzZWxlY3RlZDtcbiAgICB9XG5cbiAgICBUYWIucHJvdG90eXBlID0ge1xuICAgICAgICBpZDogXCJcIixcbiAgICAgICAgbmFtZTogXCJcIixcbiAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlXG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdBcHAnKS5kaXJlY3RpdmUoJ2JhY2tncm91bmQnLCBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKXtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhdHRycy5iYWNrZ3JvdW5kO1xuICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kLWltYWdlJzogJ3VybCgnICsgdXJsICsnKScsXG4gICAgICAgICAgICAgICAgJ2JhY2tncm91bmQtc2l6ZScgOiAnY292ZXInXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9KTtcblxuXG5cbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ29vZGwgb24gMy85LzIwMTYuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdDb250ZW50TW9kdWxlJywgWydDb250ZW50U2VydmljZXMnXSlcclxuICAgICAgICAuY29uZmlnKFJvdXRlQ29uZmlnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdBbGxDb250ZW50Q3RybCcsIEFsbENvbnRlbnRDdHJsKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdTZXJpYWxDb250ZW50Q3RybCcsIFNlcmlhbENvbnRlbnRDdHJsKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdGaWxtQ29udGVudEN0cmwnLCBGaWxtQ29udGVudEN0cmwpO1xyXG5cclxuICAgIGZ1bmN0aW9uIFJvdXRlQ29uZmlnKCRyb3V0ZVByb3ZpZGVyKSB7XHJcbiAgICAgICAgXCJuZ0luamVjdFwiO1xyXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9jb250ZW50L2NvbnRlbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBbGxDb250ZW50Q3RybCdcclxuICAgICAgICB9KS53aGVuKCcvZmlsbScsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2NvbnRlbnQvY29udGVudC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0ZpbG1Db250ZW50Q3RybCdcclxuICAgICAgICB9KS53aGVuKCcvc2VyaWFsJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvY29udGVudC9jb250ZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnU2VyaWFsQ29udGVudEN0cmwnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgQWxsQ29udGVudEN0cmwuJGluamVjdCA9IFsnJHNjb3BlJywgJ0NvbnRlbnRTZXJ2aWNlJ107XHJcbiAgICBmdW5jdGlvbiBBbGxDb250ZW50Q3RybCgkc2NvcGUsIENvbnRlbnRTZXJ2aWNlKSB7XHJcbiAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSBDb250ZW50U2VydmljZS5maW5kQ29udGVudCgpO1xyXG4gICAgfVxyXG5cclxuICAgIEZpbG1Db250ZW50Q3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnQ29udGVudFNlcnZpY2UnXTtcclxuICAgIGZ1bmN0aW9uIEZpbG1Db250ZW50Q3RybCgkc2NvcGUsIENvbnRlbnRTZXJ2aWNlKSB7XHJcbiAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSBDb250ZW50U2VydmljZS5maW5kQ29udGVudChudWxsLCAnRmlsbScpO1xyXG4gICAgfVxyXG5cclxuICAgIFNlcmlhbENvbnRlbnRDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICdDb250ZW50U2VydmljZSddO1xyXG4gICAgZnVuY3Rpb24gU2VyaWFsQ29udGVudEN0cmwoJHNjb3BlLCBDb250ZW50U2VydmljZSkge1xyXG4gICAgICAgICRzY29wZS5jb250ZW50ID0gQ29udGVudFNlcnZpY2UuZmluZENvbnRlbnQobnVsbCwgJ1NlcmlhbCcpO1xyXG4gICAgfVxyXG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBCcmFpZG5lciBvbiAzMC8wMS8yMDE2LlxuICovXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdBcHAnLCBbXG4gICAgICAgICduZ1JvdXRlJyxcbiAgICAgICAgJ25nQW5pbWF0ZScsXG5cbiAgICAgICAgLy9Nb2R1bGVzXG4gICAgICAgICdhcHAuYXV0aCcsXG4gICAgICAgICdDb250ZW50TW9kdWxlJyxcbiAgICAgICAgJ0NvbnRyb2xzTW9kdWxlJyxcbiAgICAgICAgJ0NvbnRlbnRDYXJkTW9kdWxlJyxcbiAgICAgICAgJ0l0ZW1Nb2R1bGUnLFxuICAgICAgICAnVXBsb2FkTW9kdWxlJyxcbiAgICAgICAgJ1Byb2ZpbGVNb2R1bGUnLFxuICAgICAgICAnUmVjZW50TW9kdWxlJ1xuICAgIF0pXG4gICAgICAgIC5jb25maWcoUm91dGVDb25maWcpXG4gICAgICAgIC5ydW4oTW9uaXRvckNvbmZpZylcbiAgICAgICAgLnJ1bihBbmFseXRpY3NDb25maWcpXG4gICAgICAgIC5jb250cm9sbGVyKFwiTmF2aWdhdGlvbkN0cmxcIiwgTmF2aWdhdGlvbkN0cmwpO1xuXG4gICAgTW9uaXRvckNvbmZpZy4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJ107XG4gICAgZnVuY3Rpb24gTW9uaXRvckNvbmZpZygkcm9vdFNjb3BlKSB7XG4gICAgICAgICRyb290U2NvcGUuYWN0aXZlVGFiID0gXCIvXCI7XG4gICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCwgbmV4dCkge1xuICAgICAgICAgICAgLy9UT0RPIGFkZCBtb25pdG9yaW5nXG4gICAgICAgICAgICBpZiAobmV4dC4kJHJvdXRlKSB7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5hY3RpdmVUYWIgPSBuZXh0LiQkcm91dGUub3JpZ2luYWxQYXRoO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBSb3V0ZUNvbmZpZy4kaW5qZWN0ID0gWyckcm91dGVQcm92aWRlcicsICckbG9jYXRpb25Qcm92aWRlciddO1xuICAgIGZ1bmN0aW9uIFJvdXRlQ29uZmlnKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xuICAgICAgICAkcm91dGVQcm92aWRlci5vdGhlcndpc2Uoe1xuICAgICAgICAgICAgcmVkaXJlY3RUbzogJy8nXG4gICAgICAgIH0pO1xuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG4gICAgfVxuXG4gICAgQW5hbHl0aWNzQ29uZmlnLiRpbmplY3QgPSBbJyRyb290U2NvcGUnLCAnJGxvY2F0aW9uJywgJyR3aW5kb3cnXTtcbiAgICBmdW5jdGlvbiBBbmFseXRpY3NDb25maWcoJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkd2luZG93KSB7XG4gICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdWNjZXNzJyxcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoISR3aW5kb3cuZ2EpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkd2luZG93LmdhKCdzZW5kJywgJ3BhZ2V2aWV3Jywge1xuICAgICAgICAgICAgICAgICAgICBwYWdlOiAkbG9jYXRpb24ucGF0aCgpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgTmF2aWdhdGlvbkN0cmwuJGluamVjdCA9IFsnJHNjb3BlJ107XG4gICAgZnVuY3Rpb24gTmF2aWdhdGlvbkN0cmwgKCRzY29wZSkge1xuICAgICAgICAkc2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCwgY3VycmVudCkge1xuICAgICAgICAgICAgdmFyIHRvdGFsV2lkdGggPSAkKCdtZW51IHVsJykud2lkdGgoKTtcbiAgICAgICAgICAgICQoXCJtZW51IHVsIGxpXCIpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbCkge1xuICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9ICQoZWwpLm91dGVyV2lkdGgoKTtcbiAgICAgICAgICAgICAgICB2YXIgdGFiID0gJHNjb3BlLnRhYnNbaW5kZXhdO1xuICAgICAgICAgICAgICAgIHRhYi5pbmRleCA9IGluZGV4O1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0YWIubGVmdCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRhYi5yaWdodCA9IHRvdGFsV2lkdGggLSB3aWR0aDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGFzdFRhYiA9ICRzY29wZS50YWJzW2luZGV4IC0gMV07XG4gICAgICAgICAgICAgICAgICAgIHRhYi5sZWZ0ID0gdG90YWxXaWR0aCAtIGxhc3RUYWIucmlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIHRhYi5yaWdodCA9IGxhc3RUYWIucmlnaHQgLSB3aWR0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hY3RpdmVUYWIuaW5kZXhPZih0YWIuaWQpID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0VGFiKHRhYik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS50YWJzID0gW1xuICAgICAgICAgICAgbmV3IFRhYihcIi9cIiwgXCLQktGB0LVcIiksXG4gICAgICAgICAgICBuZXcgVGFiKFwiL2ZpbG1cIiwgXCLQpNC40LvRjNC80YtcIiksXG4gICAgICAgICAgICBuZXcgVGFiKFwiL3NlcmlhbFwiLCBcItCh0LXRgNC40LDQu9GLXCIpLFxuICAgICAgICAgICAgbmV3IFRhYihcIi9hbmltZVwiLCBcItCQ0L3QuNC80LVcIiksXG4gICAgICAgICAgICBuZXcgVGFiKFwiL290aGVyXCIsIFwi0J/RgNC+0YfQtdC1XCIpLFxuICAgICAgICAgICAgbmV3IFRhYihcIi91cGxvYWRcIiwgXCLQl9Cw0LPRgNGD0LfQuNGC0Ywg0YTQuNC70YzQvFwiKVxuICAgICAgICBdO1xuICAgICAgICBcbiAgICAgICAgJHNjb3BlLnNlbGVjdFRhYiA9IHNlbGVjdFRhYjtcblxuICAgICAgICBmdW5jdGlvbiBzZWxlY3RUYWIodGFiKSB7XG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWRUYWI7XG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9yID0gJCgnLm1lbnUtaW5kaWNhdG9yJyk7XG4gICAgICAgICAgICB2YXIgaW5kZXggPSAkKCdsaS5hY3RpdmUtbWVudScpLmluZGV4KCk7XG5cbiAgICAgICAgICAgIHNlbGVjdGVkVGFiID0gJHNjb3BlLnRhYnNbdGFiLmluZGV4XTtcbiAgICAgICAgICAgIGlmIChpbmRleCA+IHRhYi5pbmRleCkge1xuICAgICAgICAgICAgICAgIGluZGljYXRvci5yZW1vdmVDbGFzcyhcInJpZ2h0XCIpO1xuICAgICAgICAgICAgICAgIGluZGljYXRvci5hZGRDbGFzcyhcImxlZnRcIik7XG4gICAgICAgICAgICAgICAgaW5kaWNhdG9yLmNzcyh7bGVmdDogc2VsZWN0ZWRUYWIubGVmdH0pO1xuICAgICAgICAgICAgICAgIGluZGljYXRvci5jc3Moe3JpZ2h0OiBzZWxlY3RlZFRhYi5yaWdodH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbmRpY2F0b3IucmVtb3ZlQ2xhc3MoXCJsZWZ0XCIpO1xuICAgICAgICAgICAgICAgIGluZGljYXRvci5hZGRDbGFzcyhcInJpZ2h0XCIpO1xuICAgICAgICAgICAgICAgIGluZGljYXRvci5jc3Moe3JpZ2h0OiBzZWxlY3RlZFRhYi5yaWdodH0pO1xuICAgICAgICAgICAgICAgIGluZGljYXRvci5jc3Moe2xlZnQ6IHNlbGVjdGVkVGFiLmxlZnR9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIFRhYihpZCwgbmFtZSwgc2VsZWN0ZWQpIHtcbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLnNlbGVjdGVkID0gc2VsZWN0ZWQ7XG4gICAgfVxuXG4gICAgVGFiLnByb3RvdHlwZSA9IHtcbiAgICAgICAgaWQ6IFwiXCIsXG4gICAgICAgIG5hbWU6IFwiXCIsXG4gICAgICAgIHNlbGVjdGVkOiBmYWxzZVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnQXBwJykuZGlyZWN0aXZlKCdiYWNrZ3JvdW5kJywgZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XG4gICAgICAgICAgICB2YXIgdXJsID0gYXR0cnMuYmFja2dyb3VuZDtcbiAgICAgICAgICAgIGVsZW1lbnQuY3NzKHtcbiAgICAgICAgICAgICAgICAnYmFja2dyb3VuZC1pbWFnZSc6ICd1cmwoJyArIHVybCArJyknLFxuICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kLXNpemUnIDogJ2NvdmVyJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgfSk7XG5cblxuXG59KSgpO1xuLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ29vZGwgb24gMy85LzIwMTYuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFJvdXRlQ29uZmlnLiRpbmplY3QgPSBbXCIkcm91dGVQcm92aWRlclwiXTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdDb250ZW50TW9kdWxlJywgWydDb250ZW50U2VydmljZXMnXSlcclxuICAgICAgICAuY29uZmlnKFJvdXRlQ29uZmlnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdBbGxDb250ZW50Q3RybCcsIEFsbENvbnRlbnRDdHJsKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdTZXJpYWxDb250ZW50Q3RybCcsIFNlcmlhbENvbnRlbnRDdHJsKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdGaWxtQ29udGVudEN0cmwnLCBGaWxtQ29udGVudEN0cmwpO1xyXG5cclxuICAgIGZ1bmN0aW9uIFJvdXRlQ29uZmlnKCRyb3V0ZVByb3ZpZGVyKSB7XHJcbiAgICAgICAgXCJuZ0luamVjdFwiO1xyXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9jb250ZW50L2NvbnRlbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBbGxDb250ZW50Q3RybCdcclxuICAgICAgICB9KS53aGVuKCcvZmlsbScsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2NvbnRlbnQvY29udGVudC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0ZpbG1Db250ZW50Q3RybCdcclxuICAgICAgICB9KS53aGVuKCcvc2VyaWFsJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvY29udGVudC9jb250ZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnU2VyaWFsQ29udGVudEN0cmwnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgQWxsQ29udGVudEN0cmwuJGluamVjdCA9IFsnJHNjb3BlJywgJ0NvbnRlbnRTZXJ2aWNlJ107XHJcbiAgICBmdW5jdGlvbiBBbGxDb250ZW50Q3RybCgkc2NvcGUsIENvbnRlbnRTZXJ2aWNlKSB7XHJcbiAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSBDb250ZW50U2VydmljZS5maW5kQ29udGVudCgpO1xyXG4gICAgfVxyXG5cclxuICAgIEZpbG1Db250ZW50Q3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnQ29udGVudFNlcnZpY2UnXTtcclxuICAgIGZ1bmN0aW9uIEZpbG1Db250ZW50Q3RybCgkc2NvcGUsIENvbnRlbnRTZXJ2aWNlKSB7XHJcbiAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSBDb250ZW50U2VydmljZS5maW5kQ29udGVudChudWxsLCAnRmlsbScpO1xyXG4gICAgfVxyXG5cclxuICAgIFNlcmlhbENvbnRlbnRDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICdDb250ZW50U2VydmljZSddO1xyXG4gICAgZnVuY3Rpb24gU2VyaWFsQ29udGVudEN0cmwoJHNjb3BlLCBDb250ZW50U2VydmljZSkge1xyXG4gICAgICAgICRzY29wZS5jb250ZW50ID0gQ29udGVudFNlcnZpY2UuZmluZENvbnRlbnQobnVsbCwgJ1NlcmlhbCcpO1xyXG4gICAgfVxyXG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIFxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5hdXRoJywgWyduZ1JvdXRlJywgJ25nUmVzb3VyY2UnLCAnbmdDb29raWVzJywgJ0NvbnRyb2xzTW9kdWxlJ10pO1xyXG59KSgpO1xuLyoqXHJcbiAqIENyZWF0ZWQgYnkgVXNlciBvbiAxNS4wNi4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ1VwbG9hZE1vZHVsZScsIFsnbmdSZXNvdXJjZSddKTtcclxuXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ0NvbnRlbnRNb2R1bGUnKS5mYWN0b3J5KCdDb250ZW50UmVzb3VyY2UnLCBDb250ZW50UmVzb3VyY2UpO1xyXG5cclxuICAgIENvbnRlbnRSZXNvdXJjZS4kaW5qZWN0ID0gWyckcmVzb3VyY2UnXTtcclxuICAgIGZ1bmN0aW9uIENvbnRlbnRSZXNvdXJjZSgkcmVzb3VyY2UpIHtcclxuICAgICAgICByZXR1cm4gJHJlc291cmNlKCdhcGkvY29udGVudC97aWR9Jyk7XHJcbiAgICB9XHJcbn0pKCk7XG4vKipcclxuICogQ3JlYXRlZCBieSBnb29kbCBvbiAzLzkvMjAxNi5cclxuICovXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdDb250ZW50U2VydmljZXMnLCBbJ25nUmVzb3VyY2UnXSlcclxuICAgICAgICAuZmFjdG9yeSgnQ29udGVudFNlcnZpY2UnLCBDb250ZW50U2VydmljZSk7XHJcblxyXG4gICAgQ29udGVudFNlcnZpY2UuJGluamVjdCA9IFsnJHJlc291cmNlJ107XHJcbiAgICBmdW5jdGlvbiBDb250ZW50U2VydmljZSgkcmVzb3VyY2UpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgdmFyIENvbnRlbnQgPSAkcmVzb3VyY2UoJy9yZXN0L2NvbnRlbnQnLCB7fSwge30pO1xyXG4gICAgICAgIHNlbGYuZmluZENvbnRlbnQgPSBmaW5kQ29udGVudDtcclxuICAgICAgICBzZWxmLmNyZWF0ZUNvbnRlbnQgPSBjcmVhdGVDb250ZW50O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBmaW5kQ29udGVudChuYW1lLCB0eXBlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBDb250ZW50LnF1ZXJ5KHtuYW1lOiBuYW1lLCB0eXBlOiB0eXBlfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVDb250ZW50KGNvbnRlbnREYXRhKSB7XHJcbiAgICAgICAgICAgIHZhciBjb250ZW50ID0gbmV3IENvbnRlbnQoY29udGVudERhdGEpO1xyXG4gICAgICAgICAgICBjb250ZW50LiRzYXZlKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBjb250ZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gc2VsZjtcclxuICAgIH1cclxufSkoKTtcclxuXG4vKipcclxuICogQ3JlYXRlZCBieSBnb29kbCBvbiAzLzEzLzIwMTYuXHJcbiAqL1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgUm91dGVDb25maWcuJGluamVjdCA9IFtcIiRyb3V0ZVByb3ZpZGVyXCJdO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ0NvbnRlbnRDYXJkTW9kdWxlJywgW10pO1xyXG4gICAgXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnQ29udGVudENhcmRNb2R1bGUnKVxyXG4gICAgICAgIC5jb25maWcoUm91dGVDb25maWcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0ZpbG1DYXJkQ3RybCcsIEZpbG1DYXJkQ3RybClcclxuICAgICAgICAuY29udHJvbGxlcignU2VyaWFsQ2FyZEN0cmwnLCBTZXJpYWxDYXJkQ3RybCk7XHJcblxyXG4gICAgZnVuY3Rpb24gUm91dGVDb25maWcoJHJvdXRlUHJvdmlkZXIpIHtcclxuICAgICAgICBcIm5nSW5qZWN0XCI7XHJcbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL2ZpbG0vOmNvbnRlbnRfaWQnLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9jb250ZW50LWNhcmQvY29udGVudC1jYXJkLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnRmlsbUNhcmRDdHJsJ1xyXG4gICAgICAgIH0pLndoZW4oJy9zZXJpYWwvOmNvbnRlbnRfaWQnLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9jb250ZW50LWNhcmQvY29udGVudC1jYXJkLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnU2VyaWFsQ2FyZEN0cmwnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gRmlsbUNhcmRDdHJsKCkge1xyXG4gICAgICAgIFwibmdJbmplY3RcIjtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBTZXJpYWxDYXJkQ3RybCgpIHtcclxuICAgICAgICBcIm5nSW5qZWN0XCI7XHJcbiAgICB9XHJcbiAgICBcclxufSkoKTtcbi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdvb2RsIG9uIDQvMi8yMDE2LlxyXG4gKi9cclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ0NvbnRyb2xzTW9kdWxlJywgW1xyXG4gICAgICAgICdjb250cm9sLmlucHV0LWNvbnRyb2wnLCBcclxuICAgICAgICAnY29udHJvbC5wYXJzZXInLFxyXG4gICAgICAgICdjb250cm9sLmlucHV0LWNodW5rJ1xyXG4gICAgXSk7XHJcbn0pKCk7XG4vKipcclxuICogQ3JlYXRlZCBieSBnb29kbCBvbiAzLzkvMjAxNi5cclxuICovXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnSXRlbU1vZHVsZScsIFtdKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ2NvbnRlbnRJdGVtJywgY29udGVudEl0ZW0pO1xyXG5cclxuICAgIGNvbnRlbnRJdGVtLiRpbmplY3QgPSBbJyRsb2NhdGlvbiddO1xyXG4gICAgZnVuY3Rpb24gY29udGVudEl0ZW0oJGxvY2F0aW9uKSB7XHJcbiAgICAgICAgXCJuZ0luamVjdFwiO1xyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcihzY29wZSwgZWxlbWVudCwgYXR0cikge1xyXG4gICAgICAgICAgICBlbGVtZW50Lm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIgKyBhbmd1bGFyLmxvd2VyY2FzZShzY29wZS5pdGVtLnR5cGUpICtcIi9cIiArIHNjb3BlLml0ZW0uaWQpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBsaW5rOiBsaW5rZXIsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBpdGVtOiAnPSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2l0ZW0vaXRlbS5odG1sJ1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5hdXRoJykuY29udHJvbGxlcignTG9naW5Db250cm9sbGVyJywgTG9naW5Db250cm9sbGVyKTtcclxuXHJcbiAgICBMb2dpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnQXV0aFNlcnZpY2UnLCBcIiRsb2NhdGlvblwiLCAnJHNjb3BlJ107XHJcbiAgICBmdW5jdGlvbiBMb2dpbkNvbnRyb2xsZXIoQXV0aFNlcnZpY2UsICRsb2NhdGlvbiwgJHNjb3BlKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBzZWxmLmF1dGggPSBhdXRoO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdvYXV0aDpsb2dpbicsIGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQpO1xyXG4gICAgICAgICAgICBpZiAoQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKSB7XHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGF1dGgobG9naW4sIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmxvZ2luKGxvZ2luLCBwYXNzd29yZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmF1dGgnKVxyXG4gICAgICAgIC5ydW4oUm91dGVJbnRlcmNlcHRvcilcclxuICAgICAgICAuY29uZmlnKFJvdXRlQ29uZmlnKTtcclxuXHJcbiAgICBSb3V0ZUNvbmZpZy4kaW5qZWN0ID0gWyckcm91dGVQcm92aWRlciddO1xyXG4gICAgZnVuY3Rpb24gUm91dGVDb25maWcoJHJvdXRlUHJvdmlkZXIpIHtcclxuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvbG9naW4nLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9sb2dpbi9sb2dpbi5odG1sJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIFJvdXRlSW50ZXJjZXB0b3IuJGluamVjdCA9IFsnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnQXV0aFNlcnZpY2UnXTtcclxuICAgIGZ1bmN0aW9uIFJvdXRlSW50ZXJjZXB0b3IoJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBBdXRoU2VydmljZSkge1xyXG4gICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCwgbmV4dCwgY3VycmVudCkge1xyXG4gICAgICAgICAgICAvL2pzaGludCBkZWJ1ZzogdHJ1ZVxyXG4gICAgICAgICAgICBkZWJ1Z2dlcjtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkICsgJyA6ICcgKyBuZXh0LiQkcm91dGUub3JpZ2luYWxQYXRoKTtcclxuICAgICAgICAgICAgaWYgKCFBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQgJiYgbmV4dC4kJHJvdXRlLm9yaWdpbmFsUGF0aCAhPSAnL2xvZ2luJykge1xyXG5cclxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25lZWQgYXV0aCcpO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5hdXRoJylcclxuICAgICAgICAuZmFjdG9yeSgnQXV0aFNlcnZpY2UnLCBBdXRoU2VydmljZSlcclxuICAgICAgICAuZmFjdG9yeSgnQXV0aFJlc291cmNlJywgQXV0aFJlc291cmNlKTtcclxuXHJcbiAgICBBdXRoU2VydmljZS4kaW5qZWN0ID0gWydBdXRoUmVzb3VyY2UnLCAnJGh0dHAnLCAnJGh0dHBQYXJhbVNlcmlhbGl6ZXInLCAnJGNvb2tpZXMnLCAnJHJvb3RTY29wZSddO1xyXG4gICAgZnVuY3Rpb24gQXV0aFNlcnZpY2UoQXV0aFJlc291cmNlLCAkaHR0cCwgJGh0dHBQYXJhbVNlcmlhbGl6ZXIsICRjb29raWVzLCAkcm9vdFNjb3BlKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBzZWxmLmlzQXV0aGVudGljYXRlZCA9IGZhbHNlO1xyXG4gICAgICAgIHNlbGYubG9naW4gPSBsb2dpbjtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbG9naW4oZW1haWwsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIEF1dGhSZXNvdXJjZS5hdXRoKCRodHRwUGFyYW1TZXJpYWxpemVyKFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlOiAndWknLFxyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBlbWFpbCxcclxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICAgICAgZ3JhbnRfdHlwZTogJ3Bhc3N3b3JkJ1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApKS4kcHJvbWlzZS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vbi5BdXRob3JpemF0aW9uID0gJ0JlYXJlciAnICsgZGF0YS5hY2Nlc3NfdG9rZW47XHJcbiAgICAgICAgICAgICAgICAkY29va2llcy5wdXQoXCJhY2Nlc3NfdG9rZW5cIiwgZGF0YS5hY2Nlc3NfdG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdvYXV0aDpsb2dpbicsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuaXNBdXRoZW50aWNhdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRlbWl0KCdvYXV0aDpsb2dpbicpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZWxmO1xyXG4gICAgfVxyXG5cclxuICAgIEF1dGhSZXNvdXJjZS4kaW5qZWN0ID0gWyckcmVzb3VyY2UnXTtcclxuICAgIGZ1bmN0aW9uIEF1dGhSZXNvdXJjZSgkcmVzb3VyY2UpIHtcclxuICAgICAgICByZXR1cm4gJHJlc291cmNlKCcvYXBpL2F1dGgvOnBhdGgvOnRva2VuJywge30sIHtcclxuICAgICAgICAgICAgJ2F1dGgnOiB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywgcGFyYW1zOiB7cGF0aDogJ29hdXRoJywgdG9rZW46ICd0b2tlbid9LCBpc0FycmF5OiBmYWxzZSwgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogJ0Jhc2ljIFluSnZkM05sY2pvPScsXHJcbiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9dXRmLTgnXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSkoKTtcbi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdvb2RsIG9uIDMvMjEvMjAxNi5cclxuICovXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBcclxuICAgIFJvdXRlQ29uZmlnLiRpbmplY3QgPSBbXCIkcm91dGVQcm92aWRlclwiXTtcclxuICAgIFByb2ZpbGVDb25maWcuJGluamVjdCA9IFtcIiRyb290U2NvcGVcIl07XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnUHJvZmlsZU1vZHVsZScsIFtdKTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdQcm9maWxlTW9kdWxlJykuY29uZmlnKFJvdXRlQ29uZmlnKTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdQcm9maWxlTW9kdWxlJykucnVuKFByb2ZpbGVDb25maWcpO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ1Byb2ZpbGVNb2R1bGUnKS5jb250cm9sbGVyKCdQcm9maWxlQ3RybCcsIFByb2ZpbGVDdHJsKTtcclxuXHJcbiAgICBmdW5jdGlvbiBSb3V0ZUNvbmZpZygkcm91dGVQcm92aWRlcikge1xyXG4gICAgICAgIFwibmdJbmplY3RcIjtcclxuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvcHJvZmlsZScsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL3Byb2ZpbGUvcHJvZmlsZS5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1Byb2ZpbGVDdHJsJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBQcm9maWxlQ29uZmlnKCRyb290U2NvcGUpIHtcclxuICAgICAgICAkcm9vdFNjb3BlLnByb2ZpbGUgPSB7bG9naW46IFwiQnJhaWRuZXJcIiwgcGVybXM6IFsndXNlcjplZGl0OnByb2ZpbGUnXX07XHJcbiAgICAgICAgJHJvb3RTY29wZS5oYXNQZXJtaXNzaW9uID0gaGFzUGVybWlzc2lvbjtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGFzUGVybWlzc2lvbihwZXJtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwcm9maWxlLnBlcm1zLmluZGV4T2YocGVybSkgPiAtMTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gUHJvZmlsZUN0cmwoKSB7XHJcbiAgICB9XHJcbiAgICBcclxufSkoKTtcbi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEJyYWlkbmVyXHJcbiAqL1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdSZWNlbnRNb2R1bGUnLCBbXSlcclxuICAgICAgICAuY29udHJvbGxlcihcIlJlY2VudEN0cmxcIiwgUmVjZW50Q3RybCk7XHJcblxyXG4gICAgUmVjZW50Q3RybC4kaW5qZWN0ID0gWyckc2NvcGUnXTtcclxuICAgIGZ1bmN0aW9uIFJlY2VudEN0cmwoJHNjb3BlKSB7XHJcbiAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSBbXHJcbiAgICAgICAgICAgIHtuYW1lOiAnWm9vdG9waWEnLCBwb3N0ZXI6ICdodHRwOi8vd3d3Lmtpbm9wb2lzay5ydS9pbWFnZXMvZmlsbV9iaWcvNzc1Mjc2LmpwZycsIGlkOiAwLCB0eXBlOiAnZmlsbSd9LFxyXG4gICAgICAgICAgICB7bmFtZTogJ0JhdG1hbiB2IFN1cGVybWFuOiBEYXduIG9mIEp1c3RpY2UnLCBwb3N0ZXI6ICdodHRwOi8vd3d3Lmtpbm9wb2lzay5ydS9pbWFnZXMvZmlsbV9iaWcvNzcwNjMxLmpwZycsIGlkOiAwLCB0eXBlOiAnZmlsbSd9LFxyXG4gICAgICAgICAgICB7bmFtZTogJ1RoZSBKdXN0aWNlIExlYWd1ZSBQYXJ0IE9uZScsIHBvc3RlcjogJ2h0dHA6Ly93d3cua2lub3BvaXNrLnJ1L2ltYWdlcy9maWxtX2JpZy80MjQ5OTQuanBnJywgaWQ6IDAsIHR5cGU6ICdmaWxtJ30sXHJcbiAgICAgICAgICAgIHtuYW1lOiAnVGhlIGZsYXNoJywgcG9zdGVyOiAnaHR0cDovL3d3dy5raW5vcG9pc2sucnUvaW1hZ2VzL2ZpbG1fYmlnLzgxNzUwNi5qcGcnLCBpZDogMCwgdHlwZTogJ2ZpbG0nfSxcclxuICAgICAgICAgICAge25hbWU6ICdUaGUgSnVzdGljZSBMZWFndWUgUGFydCBPbmUnLCBwb3N0ZXI6ICdodHRwOi8vd3d3Lmtpbm9wb2lzay5ydS9pbWFnZXMvZmlsbV9iaWcvNDI0OTk0LmpwZycsIGlkOiAwLCB0eXBlOiAnZmlsbSd9LFxyXG4gICAgICAgICAgICB7bmFtZTogJ0Zyb3plbicsIHBvc3RlcjogJ2h0dHA6Ly93d3cua2lub3BvaXNrLnJ1L2ltYWdlcy9maWxtX2JpZy80OTMyMDguanBnJywgaWQ6IDAsIHR5cGU6ICdmaWxtJ30sXHJcbiAgICAgICAgICAgIHtuYW1lOiAnQmF0bWFuIHYgU3VwZXJtYW46IERhd24gb2YgSnVzdGljZScsIHBvc3RlcjogJ2h0dHA6Ly93d3cua2lub3BvaXNrLnJ1L2ltYWdlcy9maWxtX2JpZy83NzA2MzEuanBnJywgaWQ6IDAsIHR5cGU6ICdmaWxtJ30sXHJcbiAgICAgICAgICAgIHtuYW1lOiAnVW50aXRsZWQgU3BpZGVyLU1hbiBSZWJvb3QnLCBwb3N0ZXI6ICdodHRwOi8vd3d3Lmtpbm9wb2lzay5ydS9pbWFnZXMvZmlsbV9iaWcvNjkwNTkzLmpwZycsIGlkOiAwLCB0eXBlOiAnZmlsbSd9XHJcbiAgICAgICAgXTtcclxuICAgIH1cclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnUmVjZW50TW9kdWxlJykuZGlyZWN0aXZlKCdvd2xDYXJvdXNlbCcsIGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgdmFyIGxpbmtlciA9IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cikge1xyXG5cclxuICAgICAgICAgICAgdmFyIGxvYWRDYXJvdXNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQub3dsQ2Fyb3VzZWwoXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb29wOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmF2OiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2l2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgMTIwMDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiA2XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOTkyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IDRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA3Njg6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogM1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQ3OToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiAyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoQ29sbGVjdGlvbihhdHRyLm93bENhcm91c2VsLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBsb2FkQ2Fyb3VzZWwoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkFcIixcclxuICAgICAgICAgICAgbGluazogbGlua2VyXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICB9KTtcclxufSkoKTtcbi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFVzZXIgb24gMTUuMDYuMjAxNi5cclxuICovXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnVXBsb2FkTW9kdWxlJykuY29udHJvbGxlcignVXBsb2FkQ3RybCcsIFVwbG9hZEN0cmwpO1xyXG5cclxuICAgIFVwbG9hZEN0cmwuJGluamVjdCA9IFsnVXBsb2FkRGF0YScsICdVcGxvYWRTZXJ2aWNlJ107XHJcbiAgICBmdW5jdGlvbiBVcGxvYWRDdHJsKFVwbG9hZERhdGEsIFVwbG9hZFNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGNvbnRlbnQgPSBVcGxvYWREYXRhLmdldCgpO1xyXG4gICAgICAgIFVwbG9hZERhdGEuc2V0KG51bGwpO1xyXG4gICAgICAgIGlmIChjb250ZW50KSB7XHJcbiAgICAgICAgICAgIHNlbGYuY29udGVudCA9IGNvbnRlbnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZWxmLmNyZWF0ZUNvbnRlbnQgPSBVcGxvYWRTZXJ2aWNlLmNyZWF0ZUNvbnRlbnQ7XHJcbiAgICB9XHJcbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnVXBsb2FkTW9kdWxlJylcclxuICAgICAgICAuZmFjdG9yeSgnVXBsb2FkRGF0YScsIFVwbG9hZERhdGEpO1xyXG5cclxuICAgIGZ1bmN0aW9uIFVwbG9hZERhdGEoKSB7XHJcbiAgICAgICAgdmFyIHVwbG9hZERhdGEgPSB7fTtcclxuICAgICAgICBmdW5jdGlvbiBzZXQoZGF0YSkge1xyXG4gICAgICAgICAgICB1cGxvYWREYXRhID0gZGF0YTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdXBsb2FkRGF0YTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNldDogc2V0LFxyXG4gICAgICAgICAgICBnZXQ6IGdldFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBcclxufSkoKTtcbi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFVzZXIgb24gMTUuMDYuMjAxNi5cclxuICovXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnVXBsb2FkTW9kdWxlJykuY29uZmlnKFJvdXRlQ29uZmlnKTtcclxuXHJcbiAgICBSb3V0ZUNvbmZpZy4kaW5qZWN0ID0gWyckcm91dGVQcm92aWRlciddO1xyXG4gICAgZnVuY3Rpb24gUm91dGVDb25maWcoJHJvdXRlUHJvdmlkZXIpIHtcclxuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvdXBsb2FkJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvdXBsb2FkL3VwbG9hZC5odG1sJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbn0pKCk7XG4vKipcclxuICogQ3JlYXRlZCBieSBVc2VyIG9uIDE1LjA2LjIwMTYuXHJcbiAqL1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ1VwbG9hZE1vZHVsZScpLnNlcnZpY2UoJ1VwbG9hZFNlcnZpY2UnLCBVcGxvYWRTZXJ2aWNlKTtcclxuXHJcbiAgICBVcGxvYWRTZXJ2aWNlLiRpbmplY3QgPSBbJ1VwbG9hZERhdGEnLCAnQ29udGVudFJlc291cmNlJ107XHJcbiAgICBmdW5jdGlvbiBVcGxvYWRTZXJ2aWNlKHVwbG9hZERhdGEsIENvbnRlbnRSZXNvdXJjZSkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgc2VsZi5jcmVhdGVDb250ZW50ID0gY3JlYXRlQ29udGVudDtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ29udGVudCgpIHtcclxuICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSB1cGxvYWREYXRhLmdldCgpO1xyXG4gICAgICAgICAgICB2YXIgY3JlYXRlZENvbnRlbnQgPSBuZXcgQ29udGVudFJlc291cmNlKGNvbnRlbnQpO1xyXG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlZENvbnRlbnQuaWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VsZjtcclxuICAgIH1cclxufSkoKTtcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnY29udHJvbC5pbnB1dC1jaHVuaycsIFtdKTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdjb250cm9sLmlucHV0LWNodW5rJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdsbUlucHV0Q2h1bmsnLCBpbnB1dENodW5rKTtcclxuICAgIFxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBpbnB1dENodW5rKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBiaW5kTW9kZWw6Jz1uZ01vZGVsJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbiAgICAgICAgICAgIC8vIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXHJcbiAgICAgICAgICAgICd0ZW1wbGF0ZVVybCc6ICcvYXBwL2NvbnRyb2wvaW5wdXQtY2h1bmsvaW5wdXQtY2h1bmsuaHRtbCcsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSwgYXR0ciwgbmdNb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpO1xuLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ29vZGwgb24gNC8yLzIwMTYuXHJcbiAqL1xyXG5cclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdjb250cm9sLmlucHV0LWNvbnRyb2wnLCBbXSlcclxuICAgIC5kaXJlY3RpdmUoJ2xtSW5wdXQnLCBsbUlucHV0KTtcclxuXHJcbmZ1bmN0aW9uIGxtSW5wdXQoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgIGJpbmRNb2RlbDonPW5nTW9kZWwnXHJcbiAgICAgICAgfSxcclxuICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbiAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAndGVtcGxhdGVVcmwnOiAnL2FwcC9jb250cm9sL2lucHV0L2lucHV0LWNvbnRyb2wuaHRtbCcsXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtLCBhdHRyLCBuZ01vZGVsKSB7XHJcbiAgICAgICAgICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgICAgICAgICAvLyBlbGVtLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gICAgIGVsZW0uYWRkQ2xhc3MoJ2xtLWlucHV0LWZvY3VzZWQnKTtcclxuICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufVxuLyoqXHJcbiAqIENyZWF0ZWQgYnkgS3V6bmV0c292TkUgb24gMDQuMDQuMjAxNi5cclxuICovXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnY29udHJvbC5wYXJzZXInLCBbXSk7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ0NvbnRyb2xzTW9kdWxlJykuZGlyZWN0aXZlKCdsbVVybFBhcnNlcicsIGxtVXJsUGFyc2VyKTtcclxuXHJcbiAgICBsbVVybFBhcnNlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnJGh0dHAnLCAnVXBsb2FkRGF0YSddO1xyXG4gICAgZnVuY3Rpb24gbG1VcmxQYXJzZXIoJGxvY2F0aW9uLCAkaHR0cCwgVXBsb2FkRGF0YSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBiaW5kTW9kZWw6Jz1uZ01vZGVsJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbiAgICAgICAgICAgIC8vIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXHJcbiAgICAgICAgICAgICd0ZW1wbGF0ZVVybCc6ICcvYXBwL2NvbnRyb2wvdXJsLXBhcnNlci1jb250cm9sL3VybC1wYXJzZXItY29udHJvbC5odG1sJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtLCBhdHRyLCBuZ01vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgICAgICAgICAgICAgIGVsZW0uZmluZCgnLmJ1dHRvbicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9yZXN0L2tpbm9wb2lzaycsIHtwYXJhbXM6IHt1cmw6IHNjb3BlLmJpbmRNb2RlbH19KS50aGVuKGZ1bmN0aW9uIChyZXNwb25jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25jZS5kYXRhLnVybCA9IHNjb3BlLmJpbmRNb2RlbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVXBsb2FkRGF0YS5zZXQocmVzcG9uY2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvdXBsb2FkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuYXV0aCcsIFsnbmdSb3V0ZScsICduZ1Jlc291cmNlJywgJ25nQ29va2llcycsICdDb250cm9sc01vZHVsZSddKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBVc2VyIG9uIDE1LjA2LjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnVXBsb2FkTW9kdWxlJywgWyduZ1Jlc291cmNlJ10pO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ0NvbnRlbnRNb2R1bGUnKS5mYWN0b3J5KCdDb250ZW50UmVzb3VyY2UnLCBDb250ZW50UmVzb3VyY2UpO1xyXG5cclxuICAgIENvbnRlbnRSZXNvdXJjZS4kaW5qZWN0ID0gWyckcmVzb3VyY2UnXTtcclxuICAgIGZ1bmN0aW9uIENvbnRlbnRSZXNvdXJjZSgkcmVzb3VyY2UpIHtcclxuICAgICAgICByZXR1cm4gJHJlc291cmNlKCdhcGkvY29udGVudC97aWR9Jyk7XHJcbiAgICB9XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ29vZGwgb24gMy85LzIwMTYuXHJcbiAqL1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnQ29udGVudFNlcnZpY2VzJywgWyduZ1Jlc291cmNlJ10pXHJcbiAgICAgICAgLmZhY3RvcnkoJ0NvbnRlbnRTZXJ2aWNlJywgQ29udGVudFNlcnZpY2UpO1xyXG5cclxuICAgIENvbnRlbnRTZXJ2aWNlLiRpbmplY3QgPSBbJyRyZXNvdXJjZSddO1xyXG4gICAgZnVuY3Rpb24gQ29udGVudFNlcnZpY2UoJHJlc291cmNlKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHZhciBDb250ZW50ID0gJHJlc291cmNlKCcvcmVzdC9jb250ZW50Jywge30sIHt9KTtcclxuICAgICAgICBzZWxmLmZpbmRDb250ZW50ID0gZmluZENvbnRlbnQ7XHJcbiAgICAgICAgc2VsZi5jcmVhdGVDb250ZW50ID0gY3JlYXRlQ29udGVudDtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZmluZENvbnRlbnQobmFtZSwgdHlwZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gQ29udGVudC5xdWVyeSh7bmFtZTogbmFtZSwgdHlwZTogdHlwZX0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ29udGVudChjb250ZW50RGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgY29udGVudCA9IG5ldyBDb250ZW50KGNvbnRlbnREYXRhKTtcclxuICAgICAgICAgICAgY29udGVudC4kc2F2ZSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gY29udGVudDtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHNlbGY7XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdvb2RsIG9uIDMvMTMvMjAxNi5cclxuICovXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnQ29udGVudENhcmRNb2R1bGUnLCBbXSk7XHJcbiAgICBcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdDb250ZW50Q2FyZE1vZHVsZScpXHJcbiAgICAgICAgLmNvbmZpZyhSb3V0ZUNvbmZpZylcclxuICAgICAgICAuY29udHJvbGxlcignRmlsbUNhcmRDdHJsJywgRmlsbUNhcmRDdHJsKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdTZXJpYWxDYXJkQ3RybCcsIFNlcmlhbENhcmRDdHJsKTtcclxuXHJcbiAgICBmdW5jdGlvbiBSb3V0ZUNvbmZpZygkcm91dGVQcm92aWRlcikge1xyXG4gICAgICAgIFwibmdJbmplY3RcIjtcclxuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvZmlsbS86Y29udGVudF9pZCcsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2NvbnRlbnQtY2FyZC9jb250ZW50LWNhcmQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdGaWxtQ2FyZEN0cmwnXHJcbiAgICAgICAgfSkud2hlbignL3NlcmlhbC86Y29udGVudF9pZCcsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2NvbnRlbnQtY2FyZC9jb250ZW50LWNhcmQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdTZXJpYWxDYXJkQ3RybCdcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBGaWxtQ2FyZEN0cmwoKSB7XHJcbiAgICAgICAgXCJuZ0luamVjdFwiO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIFNlcmlhbENhcmRDdHJsKCkge1xyXG4gICAgICAgIFwibmdJbmplY3RcIjtcclxuICAgIH1cclxuICAgIFxyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdvb2RsIG9uIDQvMi8yMDE2LlxyXG4gKi9cclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ0NvbnRyb2xzTW9kdWxlJywgW1xyXG4gICAgICAgICdjb250cm9sLmlucHV0LWNvbnRyb2wnLCBcclxuICAgICAgICAnY29udHJvbC5wYXJzZXInLFxyXG4gICAgICAgICdjb250cm9sLmlucHV0LWNodW5rJ1xyXG4gICAgXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ29vZGwgb24gMy85LzIwMTYuXHJcbiAqL1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ0l0ZW1Nb2R1bGUnLCBbXSlcclxuICAgICAgICAuZGlyZWN0aXZlKCdjb250ZW50SXRlbScsIGNvbnRlbnRJdGVtKTtcclxuXHJcbiAgICBjb250ZW50SXRlbS4kaW5qZWN0ID0gWyckbG9jYXRpb24nXTtcclxuICAgIGZ1bmN0aW9uIGNvbnRlbnRJdGVtKCRsb2NhdGlvbikge1xyXG4gICAgICAgIFwibmdJbmplY3RcIjtcclxuICAgICAgICBmdW5jdGlvbiBsaW5rZXIoc2NvcGUsIGVsZW1lbnQsIGF0dHIpIHtcclxuICAgICAgICAgICAgZWxlbWVudC5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL1wiICsgYW5ndWxhci5sb3dlcmNhc2Uoc2NvcGUuaXRlbS50eXBlKSArXCIvXCIgKyBzY29wZS5pdGVtLmlkKTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbGluazogbGlua2VyLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgaXRlbTogJz0nXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9pdGVtL2l0ZW0uaHRtbCdcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmF1dGgnKS5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBMb2dpbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIExvZ2luQ29udHJvbGxlci4kaW5qZWN0ID0gWydBdXRoU2VydmljZScsIFwiJGxvY2F0aW9uXCIsICckc2NvcGUnXTtcclxuICAgIGZ1bmN0aW9uIExvZ2luQ29udHJvbGxlcihBdXRoU2VydmljZSwgJGxvY2F0aW9uLCAkc2NvcGUpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHNlbGYuYXV0aCA9IGF1dGg7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ29hdXRoOmxvZ2luJywgZnVuY3Rpb24gKHRva2VuKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKEF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCk7XHJcbiAgICAgICAgICAgIGlmIChBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQpIHtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYXV0aChsb2dpbiwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2UubG9naW4obG9naW4sIHBhc3N3b3JkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmF1dGgnKVxyXG4gICAgICAgIC5ydW4oUm91dGVJbnRlcmNlcHRvcilcclxuICAgICAgICAuY29uZmlnKFJvdXRlQ29uZmlnKTtcclxuXHJcbiAgICBSb3V0ZUNvbmZpZy4kaW5qZWN0ID0gWyckcm91dGVQcm92aWRlciddO1xyXG4gICAgZnVuY3Rpb24gUm91dGVDb25maWcoJHJvdXRlUHJvdmlkZXIpIHtcclxuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvbG9naW4nLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9sb2dpbi9sb2dpbi5odG1sJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIFJvdXRlSW50ZXJjZXB0b3IuJGluamVjdCA9IFsnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnQXV0aFNlcnZpY2UnXTtcclxuICAgIGZ1bmN0aW9uIFJvdXRlSW50ZXJjZXB0b3IoJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBBdXRoU2VydmljZSkge1xyXG4gICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCwgbmV4dCwgY3VycmVudCkge1xyXG4gICAgICAgICAgICAvL2pzaGludCBkZWJ1ZzogdHJ1ZVxyXG4gICAgICAgICAgICBkZWJ1Z2dlcjtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkICsgJyA6ICcgKyBuZXh0LiQkcm91dGUub3JpZ2luYWxQYXRoKTtcclxuICAgICAgICAgICAgaWYgKCFBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQgJiYgbmV4dC4kJHJvdXRlLm9yaWdpbmFsUGF0aCAhPSAnL2xvZ2luJykge1xyXG5cclxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25lZWQgYXV0aCcpO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuYXV0aCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ0F1dGhTZXJ2aWNlJywgQXV0aFNlcnZpY2UpXHJcbiAgICAgICAgLmZhY3RvcnkoJ0F1dGhSZXNvdXJjZScsIEF1dGhSZXNvdXJjZSk7XHJcblxyXG4gICAgQXV0aFNlcnZpY2UuJGluamVjdCA9IFsnQXV0aFJlc291cmNlJywgJyRodHRwJywgJyRodHRwUGFyYW1TZXJpYWxpemVyJywgJyRjb29raWVzJywgJyRyb290U2NvcGUnXTtcclxuICAgIGZ1bmN0aW9uIEF1dGhTZXJ2aWNlKEF1dGhSZXNvdXJjZSwgJGh0dHAsICRodHRwUGFyYW1TZXJpYWxpemVyLCAkY29va2llcywgJHJvb3RTY29wZSkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgc2VsZi5pc0F1dGhlbnRpY2F0ZWQgPSBmYWxzZTtcclxuICAgICAgICBzZWxmLmxvZ2luID0gbG9naW47XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxvZ2luKGVtYWlsLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICBBdXRoUmVzb3VyY2UuYXV0aCgkaHR0cFBhcmFtU2VyaWFsaXplcihcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZTogJ3VpJyxcclxuICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogZW1haWwsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkLFxyXG4gICAgICAgICAgICAgICAgICAgIGdyYW50X3R5cGU6ICdwYXNzd29yZCdcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKSkuJHByb21pc2UudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb24uQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIGRhdGEuYWNjZXNzX3Rva2VuO1xyXG4gICAgICAgICAgICAgICAgJGNvb2tpZXMucHV0KFwiYWNjZXNzX3Rva2VuXCIsIGRhdGEuYWNjZXNzX3Rva2VuKTtcclxuICAgICAgICAgICAgICAgIHNlbGYuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnb2F1dGg6bG9naW4nLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmlzQXV0aGVudGljYXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgnb2F1dGg6bG9naW4nKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VsZjtcclxuICAgIH1cclxuXHJcbiAgICBBdXRoUmVzb3VyY2UuJGluamVjdCA9IFsnJHJlc291cmNlJ107XHJcbiAgICBmdW5jdGlvbiBBdXRoUmVzb3VyY2UoJHJlc291cmNlKSB7XHJcbiAgICAgICAgcmV0dXJuICRyZXNvdXJjZSgnL2FwaS9hdXRoLzpwYXRoLzp0b2tlbicsIHt9LCB7XHJcbiAgICAgICAgICAgICdhdXRoJzoge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsIHBhcmFtczoge3BhdGg6ICdvYXV0aCcsIHRva2VuOiAndG9rZW4nfSwgaXNBcnJheTogZmFsc2UsIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6ICdCYXNpYyBZbkp2ZDNObGNqbz0nLFxyXG4gICAgICAgICAgICAgICAgICAgICdDb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PXV0Zi04J1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ29vZGwgb24gMy8yMS8yMDE2LlxyXG4gKi9cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIFxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ1Byb2ZpbGVNb2R1bGUnLCBbXSk7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnUHJvZmlsZU1vZHVsZScpLmNvbmZpZyhSb3V0ZUNvbmZpZyk7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnUHJvZmlsZU1vZHVsZScpLnJ1bihQcm9maWxlQ29uZmlnKTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdQcm9maWxlTW9kdWxlJykuY29udHJvbGxlcignUHJvZmlsZUN0cmwnLCBQcm9maWxlQ3RybCk7XHJcblxyXG4gICAgZnVuY3Rpb24gUm91dGVDb25maWcoJHJvdXRlUHJvdmlkZXIpIHtcclxuICAgICAgICBcIm5nSW5qZWN0XCI7XHJcbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL3Byb2ZpbGUnLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9wcm9maWxlL3Byb2ZpbGUuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdQcm9maWxlQ3RybCdcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gUHJvZmlsZUNvbmZpZygkcm9vdFNjb3BlKSB7XHJcbiAgICAgICAgJHJvb3RTY29wZS5wcm9maWxlID0ge2xvZ2luOiBcIkJyYWlkbmVyXCIsIHBlcm1zOiBbJ3VzZXI6ZWRpdDpwcm9maWxlJ119O1xyXG4gICAgICAgICRyb290U2NvcGUuaGFzUGVybWlzc2lvbiA9IGhhc1Blcm1pc3Npb247XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGhhc1Blcm1pc3Npb24ocGVybSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcHJvZmlsZS5wZXJtcy5pbmRleE9mKHBlcm0pID4gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIFByb2ZpbGVDdHJsKCkge1xyXG4gICAgfVxyXG4gICAgXHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgQnJhaWRuZXJcclxuICovXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ1JlY2VudE1vZHVsZScsIFtdKVxyXG4gICAgICAgIC5jb250cm9sbGVyKFwiUmVjZW50Q3RybFwiLCBSZWNlbnRDdHJsKTtcclxuXHJcbiAgICBSZWNlbnRDdHJsLiRpbmplY3QgPSBbJyRzY29wZSddO1xyXG4gICAgZnVuY3Rpb24gUmVjZW50Q3RybCgkc2NvcGUpIHtcclxuICAgICAgICAkc2NvcGUuY29udGVudCA9IFtcclxuICAgICAgICAgICAge25hbWU6ICdab290b3BpYScsIHBvc3RlcjogJ2h0dHA6Ly93d3cua2lub3BvaXNrLnJ1L2ltYWdlcy9maWxtX2JpZy83NzUyNzYuanBnJywgaWQ6IDAsIHR5cGU6ICdmaWxtJ30sXHJcbiAgICAgICAgICAgIHtuYW1lOiAnQmF0bWFuIHYgU3VwZXJtYW46IERhd24gb2YgSnVzdGljZScsIHBvc3RlcjogJ2h0dHA6Ly93d3cua2lub3BvaXNrLnJ1L2ltYWdlcy9maWxtX2JpZy83NzA2MzEuanBnJywgaWQ6IDAsIHR5cGU6ICdmaWxtJ30sXHJcbiAgICAgICAgICAgIHtuYW1lOiAnVGhlIEp1c3RpY2UgTGVhZ3VlIFBhcnQgT25lJywgcG9zdGVyOiAnaHR0cDovL3d3dy5raW5vcG9pc2sucnUvaW1hZ2VzL2ZpbG1fYmlnLzQyNDk5NC5qcGcnLCBpZDogMCwgdHlwZTogJ2ZpbG0nfSxcclxuICAgICAgICAgICAge25hbWU6ICdUaGUgZmxhc2gnLCBwb3N0ZXI6ICdodHRwOi8vd3d3Lmtpbm9wb2lzay5ydS9pbWFnZXMvZmlsbV9iaWcvODE3NTA2LmpwZycsIGlkOiAwLCB0eXBlOiAnZmlsbSd9LFxyXG4gICAgICAgICAgICB7bmFtZTogJ1RoZSBKdXN0aWNlIExlYWd1ZSBQYXJ0IE9uZScsIHBvc3RlcjogJ2h0dHA6Ly93d3cua2lub3BvaXNrLnJ1L2ltYWdlcy9maWxtX2JpZy80MjQ5OTQuanBnJywgaWQ6IDAsIHR5cGU6ICdmaWxtJ30sXHJcbiAgICAgICAgICAgIHtuYW1lOiAnRnJvemVuJywgcG9zdGVyOiAnaHR0cDovL3d3dy5raW5vcG9pc2sucnUvaW1hZ2VzL2ZpbG1fYmlnLzQ5MzIwOC5qcGcnLCBpZDogMCwgdHlwZTogJ2ZpbG0nfSxcclxuICAgICAgICAgICAge25hbWU6ICdCYXRtYW4gdiBTdXBlcm1hbjogRGF3biBvZiBKdXN0aWNlJywgcG9zdGVyOiAnaHR0cDovL3d3dy5raW5vcG9pc2sucnUvaW1hZ2VzL2ZpbG1fYmlnLzc3MDYzMS5qcGcnLCBpZDogMCwgdHlwZTogJ2ZpbG0nfSxcclxuICAgICAgICAgICAge25hbWU6ICdVbnRpdGxlZCBTcGlkZXItTWFuIFJlYm9vdCcsIHBvc3RlcjogJ2h0dHA6Ly93d3cua2lub3BvaXNrLnJ1L2ltYWdlcy9maWxtX2JpZy82OTA1OTMuanBnJywgaWQ6IDAsIHR5cGU6ICdmaWxtJ31cclxuICAgICAgICBdO1xyXG4gICAgfVxyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdSZWNlbnRNb2R1bGUnKS5kaXJlY3RpdmUoJ293bENhcm91c2VsJywgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICB2YXIgbGlua2VyID0gZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRyKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgbG9hZENhcm91c2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5vd2xDYXJvdXNlbChcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3A6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXY6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zaXZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMjAwOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IDZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA5OTI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogNFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDc2ODoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiAzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgNDc5OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IDJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKGF0dHIub3dsQ2Fyb3VzZWwsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGxvYWRDYXJvdXNlbCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6IFwiQVwiLFxyXG4gICAgICAgICAgICBsaW5rOiBsaW5rZXJcclxuICAgICAgICB9O1xyXG5cclxuICAgIH0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFVzZXIgb24gMTUuMDYuMjAxNi5cclxuICovXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnVXBsb2FkTW9kdWxlJykuY29udHJvbGxlcignVXBsb2FkQ3RybCcsIFVwbG9hZEN0cmwpO1xyXG5cclxuICAgIFVwbG9hZEN0cmwuJGluamVjdCA9IFsnVXBsb2FkRGF0YScsICdVcGxvYWRTZXJ2aWNlJ107XHJcbiAgICBmdW5jdGlvbiBVcGxvYWRDdHJsKFVwbG9hZERhdGEsIFVwbG9hZFNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGNvbnRlbnQgPSBVcGxvYWREYXRhLmdldCgpO1xyXG4gICAgICAgIFVwbG9hZERhdGEuc2V0KG51bGwpO1xyXG4gICAgICAgIGlmIChjb250ZW50KSB7XHJcbiAgICAgICAgICAgIHNlbGYuY29udGVudCA9IGNvbnRlbnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZWxmLmNyZWF0ZUNvbnRlbnQgPSBVcGxvYWRTZXJ2aWNlLmNyZWF0ZUNvbnRlbnQ7XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIFxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ1VwbG9hZE1vZHVsZScpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1VwbG9hZERhdGEnLCBVcGxvYWREYXRhKTtcclxuXHJcbiAgICBmdW5jdGlvbiBVcGxvYWREYXRhKCkge1xyXG4gICAgICAgIHZhciB1cGxvYWREYXRhID0ge307XHJcbiAgICAgICAgZnVuY3Rpb24gc2V0KGRhdGEpIHtcclxuICAgICAgICAgICAgdXBsb2FkRGF0YSA9IGRhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGdldCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHVwbG9hZERhdGE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzZXQ6IHNldCxcclxuICAgICAgICAgICAgZ2V0OiBnZXRcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgXHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgVXNlciBvbiAxNS4wNi4yMDE2LlxyXG4gKi9cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdVcGxvYWRNb2R1bGUnKS5jb25maWcoUm91dGVDb25maWcpO1xyXG5cclxuICAgIFJvdXRlQ29uZmlnLiRpbmplY3QgPSBbJyRyb3V0ZVByb3ZpZGVyJ107XHJcbiAgICBmdW5jdGlvbiBSb3V0ZUNvbmZpZygkcm91dGVQcm92aWRlcikge1xyXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy91cGxvYWQnLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC91cGxvYWQvdXBsb2FkLmh0bWwnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBVc2VyIG9uIDE1LjA2LjIwMTYuXHJcbiAqL1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ1VwbG9hZE1vZHVsZScpLnNlcnZpY2UoJ1VwbG9hZFNlcnZpY2UnLCBVcGxvYWRTZXJ2aWNlKTtcclxuXHJcbiAgICBVcGxvYWRTZXJ2aWNlLiRpbmplY3QgPSBbJ1VwbG9hZERhdGEnLCAnQ29udGVudFJlc291cmNlJ107XHJcbiAgICBmdW5jdGlvbiBVcGxvYWRTZXJ2aWNlKHVwbG9hZERhdGEsIENvbnRlbnRSZXNvdXJjZSkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgc2VsZi5jcmVhdGVDb250ZW50ID0gY3JlYXRlQ29udGVudDtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ29udGVudCgpIHtcclxuICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSB1cGxvYWREYXRhLmdldCgpO1xyXG4gICAgICAgICAgICB2YXIgY3JlYXRlZENvbnRlbnQgPSBuZXcgQ29udGVudFJlc291cmNlKGNvbnRlbnQpO1xyXG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlZENvbnRlbnQuaWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VsZjtcclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NvbnRyb2wuaW5wdXQtY2h1bmsnLCBbXSk7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnY29udHJvbC5pbnB1dC1jaHVuaycpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnbG1JbnB1dENodW5rJywgaW5wdXRDaHVuayk7XHJcbiAgICBcclxuICAgIFxyXG4gICAgZnVuY3Rpb24gaW5wdXRDaHVuaygpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgYmluZE1vZGVsOic9bmdNb2RlbCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxyXG4gICAgICAgICAgICAvLyByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICAndGVtcGxhdGVVcmwnOiAnL2FwcC9jb250cm9sL2lucHV0LWNodW5rL2lucHV0LWNodW5rLmh0bWwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW0sIGF0dHIsIG5nTW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBLdXpuZXRzb3ZORSBvbiAwNC4wNC4yMDE2LlxyXG4gKi9cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdjb250cm9sLnBhcnNlcicsIFtdKTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnQ29udHJvbHNNb2R1bGUnKS5kaXJlY3RpdmUoJ2xtVXJsUGFyc2VyJywgbG1VcmxQYXJzZXIpO1xyXG5cclxuICAgIGxtVXJsUGFyc2VyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsICckaHR0cCcsICdVcGxvYWREYXRhJ107XHJcbiAgICBmdW5jdGlvbiBsbVVybFBhcnNlcigkbG9jYXRpb24sICRodHRwLCBVcGxvYWREYXRhKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGJpbmRNb2RlbDonPW5nTW9kZWwnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuICAgICAgICAgICAgLy8gcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgJ3RlbXBsYXRlVXJsJzogJy9hcHAvY29udHJvbC91cmwtcGFyc2VyLWNvbnRyb2wvdXJsLXBhcnNlci1jb250cm9sLmh0bWwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW0sIGF0dHIsIG5nTW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgICAgICAgICAgICAgZWxlbS5maW5kKCcuYnV0dG9uJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRodHRwLmdldCgnL3Jlc3Qva2lub3BvaXNrJywge3BhcmFtczoge3VybDogc2NvcGUuYmluZE1vZGVsfX0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbmNlLmRhdGEudXJsID0gc2NvcGUuYmluZE1vZGVsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVcGxvYWREYXRhLnNldChyZXNwb25jZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy91cGxvYWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
